<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Customer Manager | lead2025 (Optimized)</title> 
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.10.0/firebase-app.js";
        import { getFirestore, collection, query, where, getDocs, addDoc, doc, setDoc, getCountFromServer, deleteDoc } from "https://www.gstatic.com/firebasejs/10.10.0/firebase-firestore.js";

        // Your Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBcMBLjda3ZbYxo-rsyzIBXoM2JilNtMaU",
            authDomain: "digic-organization.firebaseapp.com",
            projectId: "digic-organization",
            storageBucket: "digic-organization.firebasestorage.app",
            messagingSenderId: "142724095113",
            appId: "1:142724095113:web:8104e52bbed7599d3ffa58"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        
        // --- Configuration ---
        const collectionName = "lead2025"; 
        const statusTabs = ["All Customers", "Not Started", "Login Added", "Details Updated", "Delivered"]; 
        const summaryStatuses = ["All Customers", "Not Started", "Login Added", "Details Updated", "Delivered"]; 
        let currentFilterStatus = statusTabs[0];

        // --- Utility Functions for Auto-Generation ---

        /** Generates a username based on name and mobile number. */
        function generateUsername(name, mobile) {
            if (!name || !mobile) return '';
            
            // 1. Get first 5 letters of name, converted to lowercase, removing spaces
            const sanitizedName = name.replace(/\s/g, '').toLowerCase();
            const namePart = sanitizedName.substring(0, 5);

            // 2. Get last 3 digits of mobile
            const sanitizedMobile = mobile.replace(/[^0-9]/g, '');
            const mobilePart = sanitizedMobile.slice(-3);
            
            return namePart + mobilePart;
        }

        /** Generates the full URL based on the provided username. */
        function generateUrl(username) {
            if (!username) return '';
            return `https://www.digiccard.com/${username}`;
        }

        // --- UI Utility Functions ---

        /** Sets the form fields to read-only or editable. */
        function setFormReadOnly(isReadOnly) {
            const form = document.getElementById('record-form');
            const inputs = form.querySelectorAll('input, select, button[type="submit"]');
            
            inputs.forEach(input => {
                if (input.type !== 'submit') {
                    // URL input is read-only, but should be enabled/disabled based on view mode
                    if (input.id === 'url') {
                         input.readOnly = true; 
                         // üí° FIX: Keep URL enabled (disabled = false) in read-only mode for copying
                         input.disabled = false; 
                    } 
                    // Username is editable, so just set its disabled status
                    else if (input.id === 'username') {
                         input.disabled = isReadOnly;
                    } 
                    // Other fields
                    else {
                        input.readOnly = isReadOnly;
                        input.disabled = isReadOnly;
                    }
                }
            });
            // The Copy button is ALWAYS shown when the modal is open.
            const copyBtn = document.getElementById('copy-url-button');
            if (copyBtn) copyBtn.style.display = 'block'; 

            // Show Save button only in Edit/Add mode
            form.querySelector('button[type="submit"]').style.display = isReadOnly ? 'none' : 'block';
            // Show Edit button only in View mode
            document.getElementById('edit-button').style.display = isReadOnly ? 'block' : 'none';
            // Show Delete button only for existing records
            document.getElementById('delete-button').style.display = (form.dataset.docId && !isReadOnly) ? 'block' : 'none';
        }
        
        /** Helper to populate username/url fields */
        function populateUsernameAndUrl(form) {
            const currentName = form.elements.name.value;
            const currentMobile = form.elements.mobile.value;
            
            const newUsername = generateUsername(currentName, currentMobile);
            
            // Only update username if it hasn't been manually set yet (or if it's currently empty)
            if (!form.dataset.docId || form.elements.username.value === '') {
                form.elements.username.value = newUsername;
            }
            
            // URL ALWAYS updates based on the current username field value
            const finalUsername = form.elements.username.value;
            const newUrl = generateUrl(finalUsername);

            form.elements.url.value = newUrl;
        }

        /** Helper to update URL based solely on Username field changes */
        function updateUrlFromUsername(form) {
            const finalUsername = form.elements.username.value;
            const newUrl = generateUrl(finalUsername);
            form.elements.url.value = newUrl;
        }

        /** Copies the URL field content to the clipboard. */
        window.copyUrl = function() {
            const urlInput = document.getElementById('url');
            urlInput.select();
            document.execCommand('copy');
            
            const button = document.getElementById('copy-url-button');
            const originalText = button.textContent;
            button.textContent = 'Copied!';
            setTimeout(() => {
                button.textContent = originalText;
            }, 1500);
        }


        /** * Opens the modal for viewing, editing, or adding. */
        function toggleModal(show, docData = null, isEditMode = true) {
            const modal = document.getElementById('record-modal');
            const form = document.getElementById('record-form');
            const deleteBtn = document.getElementById('delete-button');

            // Hide copy button by default when modal closes
            if (!show) {
                const copyBtn = document.getElementById('copy-url-button');
                if (copyBtn) copyBtn.style.display = 'none';
                modal.style.display = 'none';
                return;
            }

            form.reset();
            form.dataset.docId = '';
            deleteBtn.style.display = 'none'; // Hide by default
            
            // Clear existing listeners
            form.elements.name.oninput = null;
            form.elements.mobile.oninput = null;
            form.elements.username.oninput = null;

            if (docData) {
                form.dataset.docId = docData.id;
                Object.keys(docData).forEach(key => {
                    const input = form.elements[key];
                    if (input) {
                        if (key === 'soldDate' && typeof docData[key] === 'string') {
                            input.value = docData[key].split('T')[0];
                        } else {
                            input.value = docData[key];
                        }
                    }
                });
                
                setFormReadOnly(!isEditMode); 
                document.getElementById('modal-title').textContent = isEditMode ? 'Edit Customer' : 'View Customer'; 
                document.getElementById('edit-button').dataset.docId = docData.id;
                
                if (isEditMode) {
                    deleteBtn.dataset.docId = docData.id;
                    deleteBtn.style.display = 'block';
                }
                
            } else {
                document.getElementById('modal-title').textContent = 'Add New Customer'; 
                document.getElementById('soldDate').valueAsDate = new Date();
                document.getElementById('status').value = statusTabs[1];
                
                // Initial population for new records 
                form.elements.name.value = '';
                form.elements.mobile.value = '';
                form.elements.username.value = '';
                populateUsernameAndUrl(form); 
                
                setFormReadOnly(false); 
            }
            modal.style.display = 'flex';
            
            // Set up real-time population/update listeners only in Edit/Add mode
            if (!docData || isEditMode) {
                form.elements.name.oninput = () => populateUsernameAndUrl(form);
                form.elements.mobile.oninput = () => populateUsernameAndUrl(form);
                form.elements.username.oninput = () => updateUrlFromUsername(form); // Manual change updates URL
            }
        }
        
        /** Switches the modal from View Mode to Edit Mode. */
        window.enterEditMode = function() {
            const form = document.getElementById('record-form');
            const data = {
                id: form.dataset.docId,
                name: form.elements.name.value,
                companyName: form.elements.companyName.value,
                mobile: form.elements.mobile.value,
                email: form.elements.email.value,
                username: form.elements.username.value,
                phoneNumber: form.elements.phoneNumber.value,
                sellerName: form.elements.sellerName.value,
                cardType: form.elements.cardType.value,
                cardId: form.elements.cardId.value,
                price: form.elements.price.value,
                soldDate: form.elements.soldDate.value,
                status: form.elements.status.value,
                url: form.elements.url.value,
            };
            toggleModal(true, data, true);
        }

        // --- Firestore Functions ---

        async function fetchRecords(status) {
            const list = document.getElementById('records-list');
            list.innerHTML = '<div class="loading">Loading...</div>';
            
            try {
                let q;
                if (status === "All Customers") {
                    q = query(
                        collection(db, collectionName),
                        where('status', '!=', 'Delivered')
                    );
                } else {
                    q = query(
                        collection(db, collectionName), 
                        where('status', '==', status)
                    );
                }
                
                const querySnapshot = await getDocs(q);
                
                if (querySnapshot.empty) {
                    list.innerHTML = `<div class="empty-state">No ${status.toLowerCase()} found.</div>`;
                    return;
                }
                
                const fragment = document.createDocumentFragment();
                querySnapshot.forEach((doc) => {
                    const data = doc.data();
                    fragment.appendChild(createRecordCard(doc.id, data));
                });

                list.innerHTML = '';
                list.appendChild(fragment);

            } catch (error) {
                console.error("Error fetching documents: ", error);
                list.innerHTML = `<div class="error-state">Error loading data: ${error.message}</div>`;
            }
        }

        async function saveRecord(event) {
            event.preventDefault();
            const form = event.target;
            const docId = form.dataset.docId;
            const isEdit = !!docId;

            const formData = new FormData(form);
            const data = {};
            
            for (const [key, value] of formData.entries()) {
                 data[key] = value;
            }
            
            // FINAL CALCULATION: Username is taken from the field (manual or auto)
            data.username = form.elements.username.value;
            // URL MUST be calculated from the final username
            data.url = generateUrl(data.username);
            
            // Update the form fields visually as well 
            form.elements.url.value = data.url;

            const now = new Date().toISOString();
            data.updatedAt = now;
            
            try {
                if (isEdit) {
                    await setDoc(doc(db, collectionName, docId), data, { merge: true });
                    alert('Customer updated successfully!'); 
                } else {
                    data.createdAt = now;
                    await addDoc(collection(db, collectionName), data);
                    alert('Customer added successfully!'); 
                }

                toggleModal(false);
                fetchRecords(currentFilterStatus);
                fetchAndDisplaySummary();
            } catch (error) {
                console.error("Error saving document: ", error);
                alert(`Error saving customer: ${error.message}`);
            }
        }
        
        /** üí• Delete Function */
        window.deleteRecord = async function(docId) {
            if (!confirm("Are you sure you want to delete this customer? This action cannot be undone.")) {
                return;
            }

            try {
                await deleteDoc(doc(db, collectionName, docId));
                alert('Customer deleted successfully!');
                toggleModal(false); 
                fetchRecords(currentFilterStatus);
                fetchAndDisplaySummary();
            } catch (error) {
                console.error("Error deleting document: ", error);
                alert(`Error deleting customer: ${error.message}`);
            }
        }


        /** * ‚ö° OPTIMIZED: Fetches counts with fewer network calls.
         */
        async function fetchAndDisplaySummary() {
            const summaryBar = document.getElementById('status-summary');
            summaryBar.innerHTML = ''; 
            summaryBar.innerHTML = '<div class="summary-loading">Loading Summary...</div>';

            try {
                // --- 1. Get all IN-PROGRESS Leads in ONE CALL ---
                const inProgressQuery = query(
                    collection(db, collectionName),
                    where('status', '!=', 'Delivered')
                );
                const inProgressSnapshot = await getDocs(inProgressQuery);
                const inProgressDocs = inProgressSnapshot.docs;
                const totalInProgress = inProgressDocs.length;

                // --- 2. Client-Side Counting for In-Progress States ---
                const counts = {
                    "All Customers": totalInProgress,
                    "Not Started": 0,
                    "Login Added": 0,
                    "Details Updated": 0,
                    "Delivered": 0,
                };
                
                inProgressDocs.forEach(doc => {
                    const status = doc.data().status;
                    if (counts.hasOwnProperty(status)) {
                        counts[status] += 1;
                    } 
                });

                // --- 3. Get DELIVERED Leads in ONE SEPARATE CALL ---
                const deliveredQuery = query(
                    collection(db, collectionName),
                    where('status', '==', 'Delivered')
                );
                const deliveredSnapshot = await getCountFromServer(deliveredQuery);
                counts["Delivered"] = deliveredSnapshot.data().count;

                // --- 4. Render Summary ---
                summaryBar.innerHTML = '';
                const fragment = document.createDocumentFragment();

                summaryStatuses.forEach(status => {
                    const count = counts[status];
                    
                    const summaryItem = document.createElement('div');
                    const statusClass = status === "Delivered" ? 'summary-delivered' : 'summary-in-progress';
                    
                    summaryItem.className = `summary-item ${statusClass}`;
                    summaryItem.innerHTML = `
                        <div class="summary-status">${status}</div>
                        <div class="summary-count">${count}</div>
                    `;
                    fragment.appendChild(summaryItem);
                });

                summaryBar.appendChild(fragment);

            } catch (error) {
                console.error("Error fetching optimized summary counts: ", error);
                summaryBar.innerHTML = '<div class="summary-error">Error loading summary</div>';
            }
        }


        // --- UI Creation Functions ---

        const getStatusClass = (status) => {
            return status === "Delivered" ? 'status-delivered' : 'status-in-progress'; 
        };

        function createRecordCard(id, data) {
            const card = document.createElement('div');
            card.className = 'record-card';
            card.dataset.id = id;
            
            const content = document.createElement('div');
            content.className = 'card-content-area';
            
            const titleLine = document.createElement('div');
            titleLine.className = 'card-title-line';
            const statusClass = getStatusClass(data.status);
            titleLine.innerHTML = `<strong>${data.name || 'N/A'}</strong> <span class="card-status ${statusClass}">${data.status || 'N/A'}</span>`;
            content.appendChild(titleLine);

            const details = document.createElement('div');
            details.className = 'card-details';
            details.innerHTML = `
                <p>üìû: ${data.mobile || 'N/A'}</p>
                <p>üè¢: ${data.companyName || 'N/A'}</p>
                <p>üí∞: ${data.price ? `‚Çπ${data.price}` : 'N/A'} | Seller: ${data.sellerName || 'N/A'}</p>
                <p>Updated: ${data.updatedAt ? new Date(data.updatedAt).toLocaleDateString() : 'N/A'}</p>
            `;
            content.appendChild(details);
            card.appendChild(content);

            const buttonContainer = document.createElement('div');
            buttonContainer.className = 'card-button-container';

            // View Button 
            const viewBtn = document.createElement('button');
            viewBtn.className = 'card-action-btn view-btn';
            viewBtn.textContent = 'View';
            viewBtn.onclick = (e) => {
                e.stopPropagation(); 
                toggleModal(true, { id, ...data }, false);
            }; 
            buttonContainer.appendChild(viewBtn);

            // Edit Button 
            const editBtn = document.createElement('button');
            editBtn.className = 'card-action-btn edit-btn';
            editBtn.textContent = 'Edit';
            editBtn.onclick = (e) => {
                e.stopPropagation();
                toggleModal(true, { id, ...data }, true);
            };
            buttonContainer.appendChild(editBtn);

            card.appendChild(buttonContainer);

            return card;
        }

        function switchTab(status) {
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });

            document.querySelector(`.tab-button[data-status="${status}"]`).classList.add('active');
            
            currentFilterStatus = status;
            fetchRecords(status);
        }

        // --- Initialization and Event Listeners ---
        
        window.toggleModal = toggleModal;
        window.saveRecord = saveRecord;
        window.switchTab = switchTab;
        window.populateUsernameAndUrl = populateUsernameAndUrl; 

        document.addEventListener('DOMContentLoaded', () => {
            const tabsContainer = document.getElementById('status-tabs');
            
            statusTabs.forEach((status, index) => {
                const button = document.createElement('button');
                button.className = 'tab-button';
                button.dataset.status = status; 
                button.textContent = status;
                button.onclick = () => switchTab(status);
                
                if (index === 0) {
                    button.classList.add('active');
                }
                tabsContainer.appendChild(button);
            });

            // Initial data load
            fetchRecords(currentFilterStatus);
            fetchAndDisplaySummary(); 
        });
    </script>

    <style>
        /* --- General and Layout Styles --- */
        :root {
            --primary-color: #28A745; 
            --secondary-color: #f44336;
            --background-color: #f0f2f5;
            --card-background: #ffffff;
            --border-color: #ddd;
            --red-bg: #fdd;
            --red-fg: #c00;
            --green-bg: #dfd;
            --green-fg: #080;
        }

        * {
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
        }

        body {
            margin: 0;
            padding: 0;
            background-color: var(--background-color);
            padding-bottom: 70px; 
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            padding: 10px;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 10px;
        }

        .add-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            flex-shrink: 0;
        }

        .status-tabs {
            display: flex;
            overflow-x: auto;
            white-space: nowrap;
            margin-bottom: 15px;
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 5px;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
        }
        .status-tabs::-webkit-scrollbar {
            display: none;
        }

        .tab-button {
            flex-shrink: 0;
            background: none;
            border: none;
            padding: 10px 15px;
            cursor: pointer;
            font-weight: 500;
            color: #555;
            border-bottom: 3px solid transparent;
            transition: all 0.2s ease;
            font-size: 0.9em;
        }

        .tab-button.active {
            color: var(--primary-color);
            border-bottom: 3px solid var(--primary-color);
            font-weight: bold;
        }

        .record-card {
            background-color: var(--card-background);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            display: flex; 
            justify-content: space-between;
            align-items: flex-start;
        }
        
        .card-content-area {
            flex-grow: 1;
            padding-right: 15px;
        }

        .card-title-line {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 1.1em;
            margin-bottom: 8px;
            border-bottom: 1px dashed var(--border-color);
            padding-bottom: 5px;
        }
        
        .card-details p {
            margin: 3px 0;
            font-size: 0.9em;
            color: #666;
        }

        .card-status {
            font-size: 0.8em;
            padding: 4px 8px;
            border-radius: 4px;
        }
        
        .status-in-progress { background-color: var(--red-bg); color: var(--red-fg); font-weight: bold; }
        .status-delivered { background-color: var(--green-bg); color: var(--green-fg); font-weight: bold; }

        /* --- Card Button Styles --- */
        .card-button-container {
            display: flex;
            flex-direction: column;
            gap: 5px;
            flex-shrink: 0;
        }

        .card-action-btn {
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 0.9em;
            cursor: pointer;
            font-weight: bold;
            width: 70px; 
        }
        
        .view-btn { background-color: #2196F3; color: white; }
        .edit-btn { background-color: #ff9800; color: white; }

        /* --- Summary Bar Styles --- */
        #status-summary {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background-color: white;
            box-shadow: 0 -3px 8px rgba(0,0,0,0.15); 
            display: flex;
            justify-content: space-around;
            padding: 8px 5px;
            z-index: 20; 
            max-width: 600px;
            margin: 0 auto;
            left: 50%;
            transform: translateX(-50%);
        }

        .summary-item {
            flex-grow: 1;
            text-align: center;
            margin: 0 3px;
            padding: 5px 0;
            border-radius: 5px;
            font-size: 0.8em;
            font-weight: bold;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .summary-status {
            font-size: 0.9em;
            margin-bottom: 2px;
            white-space: nowrap;
        }
        
        .summary-count {
            font-size: 1.2em;
        }
        
        .summary-loading, .summary-error {
            flex-grow: 1;
            text-align: center;
            font-weight: bold;
            padding: 5px;
            color: #666;
        }

        .summary-in-progress { background-color: var(--red-bg); color: var(--red-fg); border: 1px solid var(--red-fg); }
        .summary-delivered { background-color: var(--green-bg); color: var(--green-fg); border: 1px solid var(--green-fg); }
        /* ------------------------------------------- */

        /* --- Modal Styles --- */
        .modal { 
            display: none; 
            position: fixed; 
            z-index: 10; 
            left: 0; 
            top: 0; 
            width: 100%; 
            height: 100%; 
            overflow-y: auto; 
            background-color: rgba(0,0,0,0.6); 
            justify-content: center; 
            align-items: flex-start; 
        }
        
        .modal-content { 
            background-color: #fefefe; 
            margin: 20px auto 80px auto; 
            padding: 15px; 
            border-radius: 8px; 
            width: 90%; 
            max-width: 350px; 
            box-shadow: 0 5px 15px rgba(0,0,0,0.3); 
            overflow-y: visible; 
        }
        
        .modal-header { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            border-bottom: 1px solid var(--border-color); 
            padding-bottom: 8px; 
            margin-bottom: 10px; 
        }
        .modal-header h3 {
            font-size: 1.1em; 
        }
        
        .close-btn { 
            color: #aaa; 
            font-size: 24px; 
            font-weight: bold; 
            cursor: pointer; 
        }
        
        /* Form Layout for URL and Copy Button */
        .url-group {
            position: relative;
            margin-bottom: 8px;
        }
        
        .url-group label {
            margin-bottom: 3px; 
        }

        /* Adjust input padding to fit smaller button */
        #url {
            padding-right: 50px; 
        }
        
        /* üé® ADJUSTED COPY BUTTON STYLES (Smaller) */
        #copy-url-button {
            position: absolute;
            top: 50%;
            right: 0;
            transform: translateY(-50%);
            margin-top: 10px; /* Adjust for label height */
            background-color: #007bff; 
            color: white;
            border: none;
            /* Smaller size */
            padding: 0; 
            width: 45px; /* Reduced width */
            height: 26px; /* Reduced height */
            /* */
            border-radius: 0 4px 4px 0;
            cursor: pointer;
            font-size: 0.7em; /* Smaller font */
            font-weight: 500;
            box-sizing: border-box;
            line-height: 1;
            display: flex;
            align-items: center;
            justify-content: center;
        }


        /* Reduced Form Element Sizes */
        .modal-content label { 
            display: block; 
            margin-top: 8px; 
            margin-bottom: 3px; 
            font-weight: bold; 
            font-size: 0.85em; 
        }
        
        .modal-content input, .modal-content select { 
            width: 100%; 
            padding: 8px; 
            margin-bottom: 8px; 
            border: 1px solid #ccc; 
            border-radius: 4px; 
            font-size: 0.9em; 
            transition: background-color 0.3s; 
        }
        
        .modal-content input:disabled, .modal-content select:disabled { 
            background-color: #eee; 
            color: #555; 
            cursor: default; 
            border: 1px solid #ddd; 
        }

        /* Highlight auto-populated fields (only URL is readonly now) */
        .modal-content input#url {
            background-color: #e0f7fa; 
        }
        
        /* Save Button Style */
        .modal-content button[type="submit"] { 
            background-color: var(--primary-color); 
            color: white; 
            padding: 10px 15px; 
            border: none; 
            border-radius: 4px; 
            cursor: pointer; 
            width: 100%; 
            margin-top: 10px; 
            font-weight: bold; 
            font-size: 0.95em;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); 
        }


        /* Edit Button */
        #edit-button { 
            background-color: #2196F3; 
            color: white; 
            padding: 10px 15px;
            border: none; 
            border-radius: 4px; 
            cursor: pointer; 
            width: 100%; 
            margin-top: 10px; 
            font-weight: bold; 
            display: none; 
            font-size: 0.95em;
        }
        
        /* üí• Delete Button Style */
        #delete-button { 
            background-color: var(--secondary-color); 
            color: white; 
            padding: 10px 15px; 
            border: none; 
            border-radius: 4px; 
            cursor: pointer; 
            width: 100%; 
            margin-top: 8px; 
            display: none; 
            font-size: 0.95em;
        }

        input[type="date"] { -webkit-appearance: none; -moz-appearance: none; appearance: none; }
    </style>
</head>
<body>

    <div class="container">
        <div class="header">
            <h2>Customer Manager</h2>
            <button class="add-btn" onclick="toggleModal(true)">+ Add Customer</button>
        </div>

        <div id="status-tabs" class="status-tabs">
            </div>
        
        <div id="records-list">
            <div class="loading">Loading...</div>
        </div>

    </div>

    <div id="record-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-title">Customer Details</h3>
                <span class="close-btn" onclick="toggleModal(false)">&times;</span>
            </div>
            
            <form id="record-form" onsubmit="saveRecord(event)">
                <label for="name">Name*</label><input type="text" id="name" name="name">
                <label for="companyName">Company Name</label><input type="text" id="companyName" name="companyName">
                <label for="mobile">Mobile*</label><input type="tel" id="mobile" name="mobile">
                <label for="email">Email</label><input type="text" id="email" name="email"> 
                
                <label for="username">Username (Auto, but Editable)</label>
                <input type="text" id="username" name="username">
                
                <div class="url-group">
                    <label for="url">URL (Auto-Generated)</label>
                    <input type="url" id="url" name="url" readonly>
                    <button type="button" id="copy-url-button" onclick="copyUrl()" style="display: none;">Copy</button> 
                </div>
                <label for="phoneNumber">Phone Number (Alt)</label><input type="tel" id="phoneNumber" name="phoneNumber">
                <label for="sellerName">Seller Name</label><input type="text" id="sellerName" name="sellerName">
                <label for="cardType">Card Type</label><input type="text" id="cardType" name="cardType">
                <label for="cardId">Card ID</label><input type="text" id="cardId" name="cardId">
                <label for="price">Price (‚Çπ)</label><input type="number" id="price" name="price" step="0.01">
                <label for="soldDate">Sold Date</label><input type="date" id="soldDate" name="soldDate">
                <label for="status">Status*</label>
                <select id="status" name="status">
                    <option value="Not Started">Not Started</option>
                    <option value="Login Added">Login Added</option>
                    <option value="Details Updated">Details Updated</option>
                    <option value="Delivered">Delivered</option>
                </select>
                <button type="submit">Save Record</button>
            </form>
            <button id="edit-button" onclick="enterEditMode()">Edit</button>
            <button id="delete-button" onclick="deleteRecord(this.dataset.docId)">Delete Customer</button> 
        </div>
    </div>
    
    <div id="status-summary">
        <div class="summary-loading">Loading Summary...</div>
    </div>

</body>
</html>

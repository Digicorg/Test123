<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Expense Tracker</title>
<style>
body { font-family: Arial, sans-serif; padding: 10px; background: #f9f9f9; }
form, .summary { max-width: 500px; margin: 20px auto; background: #fff; padding: 15px; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
input, select, textarea, button { width: 100%; padding: 10px; margin: 8px 0; border-radius: 5px; border: 1px solid #ccc; box-sizing: border-box; }
textarea { resize: vertical; min-height: 50px; }
button { background: #4CAF50; color: white; border: none; cursor: pointer; }
button:hover { background: #45a049; }
.expense-item, .all-expense-item { background: #f1f1f1; padding: 10px; margin: 5px 0; border-radius: 5px; display: flex; justify-content: space-between; flex-wrap: wrap; }
button.delete-btn { background: #f44336; margin-left:5px; }
button.edit-btn { background: #2196F3; margin-left:5px; }
@media(max-width: 480px){
  .expense-item, .all-expense-item { flex-direction: column; align-items: flex-start; }
  button.edit-btn, button.delete-btn { margin-top: 5px; width: 48%; }
}

/* Modal styles */
.modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.5); }
.modal-content { background-color: #fff; margin: 50px auto; padding: 20px; border-radius: 8px; max-width: 600px; max-height: 80%; overflow-y: auto; box-shadow: 0 0 15px rgba(0,0,0,0.2); }
.close-btn { background: #f44336; color: #fff; border: none; padding: 10px 15px; float: right; cursor: pointer; border-radius: 5px; }
.close-btn:hover { background: #d32f2f; }
</style>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
  const firebaseConfig = {
  apiKey: "AIzaSyBcMBLjda3ZbYxo-rsyzIBXoM2JilNtMaU",
  authDomain: "digic-organization.firebaseapp.com",
  projectId: "digic-organization",
  storageBucket: "digic-organization.firebasestorage.app",
  messagingSenderId: "142724095113",
  appId: "1:142724095113:web:8104e52bbed7598d3ffa58"
};
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();
</script>
</head>
<body>

<h2>Expense Tracker</h2>

<form id="expenseForm">
  <select id="month" required>
    <option value="">Select Month</option>
    <option>January</option><option>February</option><option>March</option>
    <option>April</option><option>May</option><option>June</option>
    <option>July</option><option>August</option><option>September</option>
    <option>October</option><option>November</option><option>December</option>
  </select>

  <select id="whoPaid" required>
    <option value="">Who Paid</option>
    <option>Fawas</option>
    <option>Favas</option>
    <option>Digic</option>
  </select>

  <select id="type" required>
    <option value="">Expense Type</option>
    <option>Salary</option>
    <option>Ad</option>
    <option>Delivery</option>
    <option>Print</option>
    <option>Others</option>
  </select>

  <input type="number" id="amount" placeholder="Amount" required />
  <textarea id="note" placeholder="Note (optional)"></textarea>
  <button type="submit">Add Expense</button>
</form>

<div class="summary">
  <h3>Monthly Summary</h3>
  <div id="monthlySummary"></div>
  <button id="showAllBtn">Show All Expenses</button>
</div>

<!-- Modal -->
<div id="allExpensesModal" class="modal">
  <div class="modal-content">
    <button class="close-btn" id="closeModalBtn">Close</button>
    <h3>All Expenses</h3>
    <div id="allExpensesList"></div>
  </div>
</div>

<script>
const form = document.getElementById('expenseForm');
const monthlySummary = document.getElementById('monthlySummary');
const allExpensesList = document.getElementById('allExpensesList');
const modal = document.getElementById('allExpensesModal');
const showAllBtn = document.getElementById('showAllBtn');
const closeModalBtn = document.getElementById('closeModalBtn');

// Add Expense
form.addEventListener('submit', e => {
  e.preventDefault();
  const month = document.getElementById('month').value;
  const whoPaid = document.getElementById('whoPaid').value;
  const type = document.getElementById('type').value;
  const amount = parseFloat(document.getElementById('amount').value);
  const note = document.getElementById('note').value;

  db.collection('expenses').add({ month, whoPaid, type, amount, note, timestamp: firebase.firestore.FieldValue.serverTimestamp() })
    .then(() => form.reset());
});

// Monthly Summary
db.collection('expenses').orderBy('timestamp','desc').onSnapshot(snapshot => {
  const summary = {};
  snapshot.forEach(doc => {
    const data = doc.data();
    if(!summary[data.month]) summary[data.month] = { Fawas:0, Favas:0, Digic:0, total:0 };
    summary[data.month][data.whoPaid] += data.amount;
    summary[data.month].total += data.amount;
  });

  monthlySummary.innerHTML = '';
  for(let month in summary){
    const div = document.createElement('div');
    div.className = 'expense-item';
    div.innerHTML = `<strong>${month}</strong><br>
      Total: ₹${summary[month].total}<br>
      Fawas: ₹${summary[month].Fawas} | Favas: ₹${summary[month].Favas} | Digic: ₹${summary[month].Digic}`;
    monthlySummary.appendChild(div);
  }
});

// Show modal
showAllBtn.addEventListener('click', () => {
  modal.style.display = 'block';
});

// Close modal
closeModalBtn.addEventListener('click', () => {
  modal.style.display = 'none';
});

// Display all expenses in modal
db.collection('expenses').orderBy('timestamp','desc').onSnapshot(snapshot => {
  allExpensesList.innerHTML = '';
  snapshot.forEach(doc => {
    const data = doc.data();
    const div = document.createElement('div');
    div.className = 'all-expense-item';
    div.innerHTML = `
      ${data.month} | ${data.whoPaid} | ${data.type} | ₹${data.amount} | ${data.note || '-'}
      <span>
        <button class="edit-btn">Edit</button>
        <button class="delete-btn">Delete</button>
      </span>
    `;

    // Delete
    div.querySelector('.delete-btn').addEventListener('click', () => {
      if(confirm('Delete this expense?')) db.collection('expenses').doc(doc.id).delete();
    });

    // Edit
    div.querySelector('.edit-btn').addEventListener('click', () => {
      const newAmount = prompt('Enter new amount', data.amount);
      const newNote = prompt('Enter note', data.note || '');
      if(newAmount!==null && !isNaN(newAmount)){
        db.collection('expenses').doc(doc.id).update({ amount: parseFloat(newAmount), note: newNote });
      }
    });

    allExpensesList.appendChild(div);
  });
});

// Close modal if clicked outside
window.addEventListener('click', e => {
  if(e.target === modal) modal.style.display = 'none';
});
</script>
</body>
</html>
